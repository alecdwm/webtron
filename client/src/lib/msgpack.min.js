this.msgpack||function(e){function t(e,t){k=0;var r=n([],e,0);return k?!1:t?s(r):r}function r(e){return v="string"==typeof e?i(e):e,b=-1,a()}function n(e,t,r){var a,s,o,u,c,i,p,h,f,l;if(null==t)e.push(192);else if(t===!1)e.push(194);else if(t===!0)e.push(195);else switch(typeof t){case"number":t!==t?e.push(203,255,255,255,255,255,255,255,255):t===1/0?e.push(203,127,240,0,0,0,0,0,0):Math.floor(t)===t?0>t?t>=-32?e.push(224+t+32):t>-128?e.push(208,t+256):t>-32768?(t+=65536,e.push(209,t>>8,255&t)):t>-2147483648?(t+=4294967296,e.push(210,t>>>24,t>>16&255,t>>8&255,255&t)):(i=Math.floor(t/4294967296),p=4294967295&t,e.push(211,i>>24&255,i>>16&255,i>>8&255,255&i,p>>24&255,p>>16&255,p>>8&255,255&p)):128>t?e.push(t):256>t?e.push(204,t):65536>t?e.push(205,t>>8,255&t):4294967296>t?e.push(206,t>>>24,t>>16&255,t>>8&255,255&t):(i=Math.floor(t/4294967296),p=4294967295&t,e.push(207,i>>24&255,i>>16&255,i>>8&255,255&i,p>>24&255,p>>16&255,p>>8&255,255&p)):(h=0>t,h&&(t*=-1),f=Math.log(t)/.6931471805599453+1023|0,l=t*Math.pow(2,1075-f),p=4294967295&l,h&&(f|=2048),i=l/4294967296&1048575|f<<20,e.push(203,i>>24&255,i>>16&255,i>>8&255,255&i,p>>24&255,p>>16&255,p>>8&255,255&p));break;case"string":for(o=t.length,c=e.length,e.push(0),s=0;o>s;++s)u=t.charCodeAt(s),128>u?e.push(127&u):2048>u?e.push(u>>>6&31|192,63&u|128):65536>u&&e.push(u>>>12&15|224,u>>>6&63|128,63&u|128);a=e.length-c-1,32>a?e[c]=160+a:65536>a?e.splice(c,1,218,a>>8,255&a):4294967296>a&&e.splice(c,1,219,a>>>24,a>>16&255,a>>8&255,255&a);break;default:if(++r>=w)return k=1,e=[];if(m(t))for(a=t.length,16>a?e.push(144+a):65536>a?e.push(220,a>>8,255&a):4294967296>a&&e.push(221,a>>>24,a>>16&255,a>>8&255,255&a),s=0;a>s;++s)n(e,t[s],r);else{c=e.length,e.push(0),a=0;for(s in t)++a,n(e,s,r),n(e,t[s],r);16>a?e[c]=128+a:65536>a?e.splice(c,1,222,a>>8,255&a):4294967296>a&&e.splice(c,1,223,a>>>24,a>>16&255,a>>8&255,255&a)}}return e}function a(){var e,t,r,n,o,u,c,i,p,h=0,f=v,l=f[++b];if(l>=224)return l-256;if(192>l){if(128>l)return l;144>l?(h=l-128,l=128):160>l?(h=l-144,l=144):(h=l-160,l=160)}switch(l){case 192:return null;case 194:return!1;case 195:return!0;case 202:return h=16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b],o=2147483648&h,u=h>>23&255,c=8388607&h,h&&2147483648!==h?255===u?c?NaN:1/0:(o?-1:1)*(8388608|c)*Math.pow(2,u-127-23):0;case 203:return h=16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b],o=2147483648&h,u=h>>20&2047,c=1048575&h,h&&2147483648!==h?2047===u?(b+=4,c?NaN:1/0):(h=16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b],(o?-1:1)*((1048576|c)*Math.pow(2,u-1023-20)+h*Math.pow(2,u-1023-52))):(b+=4,0);case 207:return h=16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b],4294967296*h+16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b];case 206:h+=16777216*f[++b]+(f[++b]<<16);case 205:h+=f[++b]<<8;case 204:return h+f[++b];case 211:return h=f[++b],128&h?-1*(72057594037927940*(255^h)+281474976710656*(255^f[++b])+1099511627776*(255^f[++b])+4294967296*(255^f[++b])+16777216*(255^f[++b])+65536*(255^f[++b])+256*(255^f[++b])+(255^f[++b])+1):72057594037927940*h+281474976710656*f[++b]+1099511627776*f[++b]+4294967296*f[++b]+16777216*f[++b]+65536*f[++b]+256*f[++b]+f[++b];case 210:return h=16777216*f[++b]+(f[++b]<<16)+(f[++b]<<8)+f[++b],2147483648>h?h:h-4294967296;case 209:return h=(f[++b]<<8)+f[++b],32768>h?h:h-65536;case 208:return h=f[++b],128>h?h:h-256;case 219:h+=16777216*f[++b]+(f[++b]<<16);case 218:h+=(f[++b]<<8)+f[++b];case 160:for(i=[],t=b,r=t+h;r>t;)n=f[++t],i.push(128>n?n:224>n?(31&n)<<6|63&f[++t]:(15&n)<<12|(63&f[++t])<<6|63&f[++t]);return b=t,i.length<10240?y.apply(null,i):s(i);case 223:h+=16777216*f[++b]+(f[++b]<<16);case 222:h+=(f[++b]<<8)+f[++b];case 128:for(p={};h--;){for(e=f[++b]-160,i=[],t=b,r=t+e;r>t;)n=f[++t],i.push(128>n?n:224>n?(31&n)<<6|63&f[++t]:(15&n)<<12|(63&f[++t])<<6|63&f[++t]);b=t,p[y.apply(null,i)]=a()}return p;case 221:h+=16777216*f[++b]+(f[++b]<<16);case 220:h+=(f[++b]<<8)+f[++b];case 144:for(i=[];h--;)i.push(a());return i}}function s(e){try{return y.apply(this,e)}catch(t){}for(var r=[],n=0,a=e.length,s=d;a>n;++n)r[n]=s[e[n]];return r.join("")}function o(e,t,r){t.method="GET",t.binary=!0,c(e,t,r)}function u(r,n,a){if(n.method="PUT",n.binary=!0,n.worker&&e.Worker){var s=new Worker(msgpack.worker);s.onmessage=function(e){n.data=e.data,c(r,n,a)},s.postMessage({method:"pack",data:n.data})}else n.data=h(t(n.data)),c(r,n,a)}function c(t,n,a){function s(){if(4===k.readyState){var t,s,o,c=k.status,h={status:c,ok:c>=200&&300>c};if(!m++){if("PUT"===l)t=h.ok?k.responseText:"";else if(h.ok){if(n.worker&&e.Worker)return s=new Worker(msgpack.worker),s.onmessage=function(e){a(e.data,n,h)},s.postMessage({method:"unpack",data:k.responseText}),void u();o=f?p(k):i(k.responseText),t=r(o)}v&&v(k,n,h),a(t,n,h),u()}}}function o(e,t){if(!m++){var r={status:t||400,ok:!1};v&&v(k,n,r),a(null,n,r),u(e)}}function u(t){t&&k&&k.abort&&k.abort(),h&&(clearTimeout(h),h=0),k=null,e.addEventListener&&e.removeEventListener("beforeunload",o,!1)}var c,h=0,l=n.method||"GET",d=n.header||{},g=n.before,v=n.after,b=n.data||null,k=e.XMLHttpRequest?new XMLHttpRequest:e.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,m=0,y="overrideMimeType",w="setRequestHeader",M="GET"===l&&n.binary;try{k.onreadystatechange=s,k.open(l,t,!0),g&&g(k,n),M&&k[y]&&k[y]("text/plain; charset=x-user-defined"),b&&k[w]("Content-Type","application/x-www-form-urlencoded");for(c in d)k[w](c,d[c]);e.addEventListener&&e.addEventListener("beforeunload",o,!1),k.send(b),h=setTimeout(function(){o(1,408)},1e3*(n.timeout||10))}catch(T){o(0,400)}}function i(e){var t,r,n=[],a=l,s=e.split(""),o=-1;for(r=s.length,t=r%8;t--;)++o,n[o]=a[s[o]];for(t=r>>3;t--;)n.push(a[s[++o]],a[s[++o]],a[s[++o]],a[s[++o]],a[s[++o]],a[s[++o]],a[s[++o]],a[s[++o]]);return n}function p(e){var t,r,n,a,s,o,u,c,i,p,h,f,l=[],d="charCodeAt",g=-1;for(f=vblen(e),t=vbstr(e),n=Math.ceil(f/2),r=n%8;r--;)a=t[d](++g),l.push(255&a,a>>8);for(r=n>>3;r--;)a=t[d](++g),s=t[d](++g),o=t[d](++g),u=t[d](++g),c=t[d](++g),i=t[d](++g),p=t[d](++g),h=t[d](++g),l.push(255&a,a>>8,255&s,s>>8,255&o,o>>8,255&u,u>>8,255&c,c>>8,255&i,i>>8,255&p,p>>8,255&h,h>>8);return f%2&&l.pop(),l}function h(t){var r=[],n=0,a=-1,s=t.length,o=[0,2,1][t.length%3],u=d,c=g;if(e.btoa){for(;s>a;)r.push(u[t[++a]]);return btoa(r.join(""))}for(--s;s>a;)n=t[++a]<<16|t[++a]<<8|t[++a],r.push(c[n>>18&63],c[n>>12&63],c[n>>6&63],c[63&n]);return o>1&&(r[r.length-2]="="),o>0&&(r[r.length-1]="="),r.join("")}e.msgpack={pack:t,unpack:r,worker:"msgpack.js",upload:u,download:o};var f=/MSIE/.test(navigator.userAgent),l={},d={},g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),v=[],b=0,k=0,m=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},y=String.fromCharCode,w=512;self.importScripts&&(onmessage=function(e){"pack"===e.data.method?postMessage(h(t(e.data.data))):postMessage(r(e.data.data))}),function(){for(var e,t=0;256>t;++t)e=y(t),l[e]=t,d[t]=e;for(t=128;256>t;++t)l[y(63232+t)]=t}(),f&&document.write('<script type="text/vbscript">Function vblen(b)vblen=LenB(b.responseBody)End Function\nFunction vbstr(b)vbstr=CStr(b.responseBody)+chr(0)End Function</script>')}(this);
